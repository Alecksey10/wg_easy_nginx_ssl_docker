#!/bin/sh

# 1. Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚, ĞµÑĞ»Ğ¸ ĞµĞ³Ğ¾ Ğ½ĞµÑ‚
if [ ! -f /etc/nginx/ssl/selfsigned.crt ]; then
    echo "ğŸ”§ Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â€” Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒÑ..."
    /generate-cert.sh
fi

# 2. Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· cron
echo "0 3 */10 * * /generate-cert.sh && nginx -s reload" > /etc/crontabs/root

# 3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ cron + nginx
echo "ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº crond Ğ¸ nginx..."
crond
nginx -g "daemon off;"
